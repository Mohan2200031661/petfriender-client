{"ast":null,"code":"import{createContext,useContext,useEffect,useMemo,useState,useCallback// Import useCallback\n}from\"react\";import{useNavigate,useLocation}from\"react-router-dom\";import{registerUser,loginUser,logoutUser,getUser}from\"../../services/api\";import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext({});export function AuthProvider(_ref){let{children}=_ref;const[user,setUser]=useState();const[message,setMessage]=useState();const[error,setError]=useState();const[loading,setLoading]=useState(false);const[loadingInitial,setLoadingInitial]=useState(true);const navigate=useNavigate();const location=useLocation();useEffect(()=>{if(error)setError(null);},[error,location.pathname]);useEffect(()=>{getUser().then(data=>{setUser(data.user);}).catch(_error=>{}).finally(()=>setLoadingInitial(false));},[]);const memoedValue=useMemo(()=>({user,message,error,loading,register,// Include register in the memoized value\nlogin,// Include login in the memoized value\nlogout// Include logout in the memoized value\n}),[user,message,error,loading]// Remove login, logout, and register from the dependency array\n);const register=useCallback(user=>{// Wrap register with useCallback\nsetLoading(true);setError(undefined);registerUser(user).then(data=>{setUser(data.user);setMessage(data.message);setTimeout(()=>{setMessage(undefined);navigate(\"/users/login\");},2000);}).catch(err=>setError(err)).finally(()=>setLoading(false));},[navigate]);const login=useCallback(user=>{// Wrap login with useCallback\nsetLoading(true);setError(undefined);loginUser(user).then(data=>{setUser(data.user);setMessage(data.message);setTimeout(()=>{setMessage(undefined);navigate(\"/users/my-account\");},2000);}).catch(err=>setError(err)).finally(()=>setLoading(false));},[navigate]);const logout=useCallback(()=>{// Wrap logout with useCallback\nlogoutUser().then(data=>{setUser(undefined);setMessage(data.message);setTimeout(()=>{setMessage(undefined);navigate(\"/\");},2000);});},[navigate]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:memoedValue,children:!loadingInitial&&children});}export default function useAuth(){return useContext(AuthContext);}","map":{"version":3,"names":["createContext","useContext","useEffect","useMemo","useState","useCallback","useNavigate","useLocation","registerUser","loginUser","logoutUser","getUser","jsx","_jsx","AuthContext","AuthProvider","_ref","children","user","setUser","message","setMessage","error","setError","loading","setLoading","loadingInitial","setLoadingInitial","navigate","location","pathname","then","data","catch","_error","finally","memoedValue","register","login","logout","undefined","setTimeout","err","Provider","value","useAuth"],"sources":["E:/MERN/backend/client/src/context/userContext/useAuth.tsx"],"sourcesContent":["import {\n  createContext,\n  ReactNode,\n  useContext,\n  useEffect,\n  useMemo,\n  useState,\n  useCallback, // Import useCallback\n} from \"react\";\nimport { useNavigate, useLocation } from \"react-router-dom\";\nimport {\n  registerUser,\n  loginUser,\n  logoutUser,\n  getUser,\n} from \"../../services/api\";\n\nconst AuthContext = createContext<AuthContextType>({} as AuthContextType);\n\nexport function AuthProvider({\n  children,\n}: {\n  children: ReactNode;\n}): JSX.Element {\n  const [user, setUser] = useState<User>();\n  const [message, setMessage] = useState<AuthMessage>();\n  const [error, setError] = useState<any>();\n  const [loading, setLoading] = useState<boolean>(false);\n  const [loadingInitial, setLoadingInitial] = useState<boolean>(true);\n  const navigate = useNavigate();\n  const location = useLocation();\n\n  useEffect(() => {\n    if (error) setError(null);\n  }, [error, location.pathname]);\n\n  useEffect(() => {\n    getUser()\n      .then((data) => {\n        setUser(data.user);\n      })\n      .catch((_error) => {})\n      .finally(() => setLoadingInitial(false));\n  }, []);\n\n  const memoedValue = useMemo(\n    () => ({\n      user,\n      message,\n      error,\n      loading,\n      register, // Include register in the memoized value\n      login, // Include login in the memoized value\n      logout, // Include logout in the memoized value\n    }),\n    [user, message, error, loading] // Remove login, logout, and register from the dependency array\n  );\n\n  const register = useCallback((user: RegisterUser) => { // Wrap register with useCallback\n    setLoading(true);\n    setError(undefined);\n    registerUser(user)\n      .then((data) => {\n        setUser(data.user);\n        setMessage(data.message);\n        setTimeout(() => {\n          setMessage(undefined);\n          navigate(\"/users/login\");\n        }, 2000);\n      })\n      .catch((err) => setError(err))\n      .finally(() => setLoading(false));\n  }, [navigate]);\n\n  const login = useCallback((user: LoginUser) => { // Wrap login with useCallback\n    setLoading(true);\n    setError(undefined);\n    loginUser(user)\n      .then((data) => {\n        setUser(data.user);\n        setMessage(data.message);\n        setTimeout(() => {\n          setMessage(undefined);\n          navigate(\"/users/my-account\");\n        }, 2000);\n      })\n      .catch((err) => setError(err))\n      .finally(() => setLoading(false));\n  }, [navigate]);\n\n  const logout = useCallback(() => { // Wrap logout with useCallback\n    logoutUser().then((data) => {\n      setUser(undefined);\n      setMessage(data.message);\n      setTimeout(() => {\n        setMessage(undefined);\n        navigate(\"/\");\n      }, 2000);\n    });\n  }, [navigate]);\n\n  return (\n    <AuthContext.Provider value={memoedValue}>\n      {!loadingInitial && children}\n    </AuthContext.Provider>\n  );\n}\n\nexport default function useAuth() {\n  return useContext(AuthContext);\n}\n"],"mappings":"AAAA,OACEA,aAAa,CAEbC,UAAU,CACVC,SAAS,CACTC,OAAO,CACPC,QAAQ,CACRC,WAAa;AAAA,KACR,OAAO,CACd,OAASC,WAAW,CAAEC,WAAW,KAAQ,kBAAkB,CAC3D,OACEC,YAAY,CACZC,SAAS,CACTC,UAAU,CACVC,OAAO,KACF,oBAAoB,CAAC,OAAAC,GAAA,IAAAC,IAAA,yBAE5B,KAAM,CAAAC,WAAW,cAAGd,aAAa,CAAkB,CAAC,CAAoB,CAAC,CAEzE,MAAO,SAAS,CAAAe,YAAYA,CAAAC,IAAA,CAIZ,IAJa,CAC3BC,QAGF,CAAC,CAAAD,IAAA,CACC,KAAM,CAACE,IAAI,CAAEC,OAAO,CAAC,CAAGf,QAAQ,CAAO,CAAC,CACxC,KAAM,CAACgB,OAAO,CAAEC,UAAU,CAAC,CAAGjB,QAAQ,CAAc,CAAC,CACrD,KAAM,CAACkB,KAAK,CAAEC,QAAQ,CAAC,CAAGnB,QAAQ,CAAM,CAAC,CACzC,KAAM,CAACoB,OAAO,CAAEC,UAAU,CAAC,CAAGrB,QAAQ,CAAU,KAAK,CAAC,CACtD,KAAM,CAACsB,cAAc,CAAEC,iBAAiB,CAAC,CAAGvB,QAAQ,CAAU,IAAI,CAAC,CACnE,KAAM,CAAAwB,QAAQ,CAAGtB,WAAW,CAAC,CAAC,CAC9B,KAAM,CAAAuB,QAAQ,CAAGtB,WAAW,CAAC,CAAC,CAE9BL,SAAS,CAAC,IAAM,CACd,GAAIoB,KAAK,CAAEC,QAAQ,CAAC,IAAI,CAAC,CAC3B,CAAC,CAAE,CAACD,KAAK,CAAEO,QAAQ,CAACC,QAAQ,CAAC,CAAC,CAE9B5B,SAAS,CAAC,IAAM,CACdS,OAAO,CAAC,CAAC,CACNoB,IAAI,CAAEC,IAAI,EAAK,CACdb,OAAO,CAACa,IAAI,CAACd,IAAI,CAAC,CACpB,CAAC,CAAC,CACDe,KAAK,CAAEC,MAAM,EAAK,CAAC,CAAC,CAAC,CACrBC,OAAO,CAAC,IAAMR,iBAAiB,CAAC,KAAK,CAAC,CAAC,CAC5C,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAS,WAAW,CAAGjC,OAAO,CACzB,KAAO,CACLe,IAAI,CACJE,OAAO,CACPE,KAAK,CACLE,OAAO,CACPa,QAAQ,CAAE;AACVC,KAAK,CAAE;AACPC,MAAQ;AACV,CAAC,CAAC,CACF,CAACrB,IAAI,CAAEE,OAAO,CAAEE,KAAK,CAAEE,OAAO,CAAE;AAClC,CAAC,CAED,KAAM,CAAAa,QAAQ,CAAGhC,WAAW,CAAEa,IAAkB,EAAK,CAAE;AACrDO,UAAU,CAAC,IAAI,CAAC,CAChBF,QAAQ,CAACiB,SAAS,CAAC,CACnBhC,YAAY,CAACU,IAAI,CAAC,CACfa,IAAI,CAAEC,IAAI,EAAK,CACdb,OAAO,CAACa,IAAI,CAACd,IAAI,CAAC,CAClBG,UAAU,CAACW,IAAI,CAACZ,OAAO,CAAC,CACxBqB,UAAU,CAAC,IAAM,CACfpB,UAAU,CAACmB,SAAS,CAAC,CACrBZ,QAAQ,CAAC,cAAc,CAAC,CAC1B,CAAC,CAAE,IAAI,CAAC,CACV,CAAC,CAAC,CACDK,KAAK,CAAES,GAAG,EAAKnB,QAAQ,CAACmB,GAAG,CAAC,CAAC,CAC7BP,OAAO,CAAC,IAAMV,UAAU,CAAC,KAAK,CAAC,CAAC,CACrC,CAAC,CAAE,CAACG,QAAQ,CAAC,CAAC,CAEd,KAAM,CAAAU,KAAK,CAAGjC,WAAW,CAAEa,IAAe,EAAK,CAAE;AAC/CO,UAAU,CAAC,IAAI,CAAC,CAChBF,QAAQ,CAACiB,SAAS,CAAC,CACnB/B,SAAS,CAACS,IAAI,CAAC,CACZa,IAAI,CAAEC,IAAI,EAAK,CACdb,OAAO,CAACa,IAAI,CAACd,IAAI,CAAC,CAClBG,UAAU,CAACW,IAAI,CAACZ,OAAO,CAAC,CACxBqB,UAAU,CAAC,IAAM,CACfpB,UAAU,CAACmB,SAAS,CAAC,CACrBZ,QAAQ,CAAC,mBAAmB,CAAC,CAC/B,CAAC,CAAE,IAAI,CAAC,CACV,CAAC,CAAC,CACDK,KAAK,CAAES,GAAG,EAAKnB,QAAQ,CAACmB,GAAG,CAAC,CAAC,CAC7BP,OAAO,CAAC,IAAMV,UAAU,CAAC,KAAK,CAAC,CAAC,CACrC,CAAC,CAAE,CAACG,QAAQ,CAAC,CAAC,CAEd,KAAM,CAAAW,MAAM,CAAGlC,WAAW,CAAC,IAAM,CAAE;AACjCK,UAAU,CAAC,CAAC,CAACqB,IAAI,CAAEC,IAAI,EAAK,CAC1Bb,OAAO,CAACqB,SAAS,CAAC,CAClBnB,UAAU,CAACW,IAAI,CAACZ,OAAO,CAAC,CACxBqB,UAAU,CAAC,IAAM,CACfpB,UAAU,CAACmB,SAAS,CAAC,CACrBZ,QAAQ,CAAC,GAAG,CAAC,CACf,CAAC,CAAE,IAAI,CAAC,CACV,CAAC,CAAC,CACJ,CAAC,CAAE,CAACA,QAAQ,CAAC,CAAC,CAEd,mBACEf,IAAA,CAACC,WAAW,CAAC6B,QAAQ,EAACC,KAAK,CAAER,WAAY,CAAAnB,QAAA,CACtC,CAACS,cAAc,EAAIT,QAAQ,CACR,CAAC,CAE3B,CAEA,cAAe,SAAS,CAAA4B,OAAOA,CAAA,CAAG,CAChC,MAAO,CAAA5C,UAAU,CAACa,WAAW,CAAC,CAChC"},"metadata":{},"sourceType":"module","externalDependencies":[]}